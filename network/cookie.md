## Cookie



### 세줄 요약

* HTTP 쿠키는 웹 사이트에서 사용자의 정보를 컴퓨터에 저장하는 작은 데이터이다. 
* 세션 관리, 개인화, 트래킹에 활용할 수 있다.
* 이름, 값, 도메인, 경로, 만료날짜, 프로토콜, 자바스크립트 접근, 크로쓰오리진 옵션 설정으로 보안을 강화할 수 있다.

<br/>
<br/>



### Cookie 개념


* **웹 브라우저 단위에 저장된 데이터**
* 용도
  * 주로 방문자의 정보를 수집하고, 수집 데이터를 통해 어떤 고객이 어떤 활동을 하는 지 추적하는 데 주로 쓰인다.
  * 그 외에도 세션 관리, 개인화, 트래킹에 사용된다. 예시 : 자동 로그인, 오늘은 그만 보기 팝업창
* 프로세스 예시
  1. 사용자가 a사이트를 이용하기 위해 로그인 요청을 보낸다.
  2. 서버는 해당 사용자가 로그인했다는 쿠키를 생성하여 Response 한다.
  3. 웹브라우저가 서버로부터 받은 쿠키를 로컬에 저장한다.
  4. 사용자가 다시 a 사이트 요청을 보낼 때, **다시 로그인 요청을 보내지 않고 위 쿠키를 header에** 함께 보낸다.
  5. 쿠키를 통해 서버는 사용자를 식별하고 사용자의 활동 내역을 기반으로 맞춤 서비스를 제공한다. 

* 특징
  * 장점 : 서버에게 해당 **데이터를 매번 request 할 필요 없으므로 속도가 빨라 사용자 경험을 개선한다.**
  * 단점 : 브라우저에 저장되기 때문에 쿠키는 조작, 삭제될 수 있다. 따라서 **보안, 개인정보보호를 강화한 쿠키 사용정책을 마련해야 한다.** 
* 종류
  - 퍼스트 파티 쿠키 : 사용자가 방문한 웹사이트에서 직접 발행하는 쿠키이다.
  - 서드 파티 쿠키 : 사용자가 방문한 웹사이트가 아닌 다른 웹사이트에서 방문한 쿠키이다.

<br/>
<br/>


### Cookie 속성

- 쿠키에는 **이름, 값, 만료 날짜, 도메인, 경로 등**의 속성이 있는데 이들을 통해 보안성을 높일 수 있다.

- **도메인은 쿠키가 사용될 수 있는 범위를 제한**한다. (ip 로는 불가능)

  - 쿠키는 특정 도메인에서 생성되어 해당 도메인, 서브 도메인에만 사용된다. 

    - naver.com 의 서브 도메인 예시 = www.naver.com
    - 그러나 서브 도메인에서 생성된 쿠키는 상위 도메인에서 사용될 수 없다. 

    - **보안, 개인 정보 보호를 강화**하기 위한 정책이다. 
    - **다른 도메인에서 쿠키를 가지고 사용자의 정보를 알 수 없다.**

- **경로를 통해 쿠키 전송 여부를 제한**한다.
  - 예시 : Path = /users 인 경우
    - 요청 경로 = /users/login # 쿠키 전송 가능
    - 요청 경로 = /user/login # 쿠키 전송 불가능

* 만료 날짜

  * **MaxAge, Expires 로 쿠키가 유효한 기간을 제한**한다. 
  * 두 옵션이 지정되어 있지 않으면, 브라우저가 닫힐 때 쿠키도 함께 삭제된다.
  * 쿠키 요효 일자는 UTC 기준이다.

* 프로토콜

  * **요청 프로토콜에 따라 쿠키 전송 가능 여부를 제한**한다.
  * **Secure=true** 인 경우 HTTPS 프로토콜로 온 요청으로만 쿠키를 전송할 수 있다. HTTP 프로토콜 요청은 불가능하다.

* 자바스크립트 접근

  * **HttpOnly = true 이면 자바스크립트에서는 쿠키 접근이 불가능**하다. 
  * 디폴트 값은 false 인데, 자바스크립트에서 접근이 가능하기 때문에 XSS 공격에 취약하다. 

* Cross-Origin 요청 정보

  * 요청에서 사용한 메소드와 SameSite 옵션의 조합으로 서버의 쿠키 전송 여부를 결정한다.

    * **sameSite="None"** : **항상 쿠키를 보내줄 수 있다. 즉, 써드 파티 쿠키를 허용한다. 이 때 Secure = true 여야 한다.**

    * sameSite="Strict" : crossOrigin이 아닌 same-site인 경우에만 쿠키를 전송할 수 있다.

    -* sameSite="Lax" (디폴트) : crossOrigin 요청이면 get 메소드에 대해서만 쿠키를 전송할 수 있다. 

      



<br/>

<br/>



<hr/>

### 참고 레퍼런스

- https://atoz-develop.tistory.com/entry/%EC%9E%91%EC%84%B1%EC%A4%91-Cookie%EC%BF%A0%ED%82%A4%EC%99%80-%EB%8F%84%EB%A9%94%EC%9D%B8%EC%9D%98-%EA%B4%80%EA%B3%84-%EC%A0%95%EB%A6%AC
- https://tigercoin.tistory.com/167
- https://bit.ly/42W4Gf6
- https://blog.rs-team.com/12
