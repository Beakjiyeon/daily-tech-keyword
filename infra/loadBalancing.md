## 로드밸런싱
### 세줄 요약
* 프로젝트의 사용자가 많아지면 스케일업으로 감당이 안되기 때문에 스케일아웃 방식을 적용해야 한다.
  * 스케일업이란 서버 자체의 성능을 향상 시키는 것으로 서버 CPU, RAM 교체
  * 스케일아웃이란 기존 서버와 동일하거나 낮은 서버를 여러 대 증설하여 운영하는 것 (비용이 더 저렴)
* 로드밸런싱은 여러 대의 서버가 분산처리할 수 있도록 요청을 나누어주는 서비스이다.
<br/>

### 로드밸런서
* 로드밸런싱을 해주는 소프트웨어 또는 하드웨어 장비
* HAProxy 는 가장 많이 사용되는 오픈소스 로드밸런서이다.
<br/>

### 로드밸런서 종류
* OSI 7계층 기준으로 나누어져 있는데 L4, L7가 백엔드 단위이다.
* L2 : mac 주소를 바탕으로 로드밸런싱
* L3 : ip 주소를 바탕으로 로드밸런싱
* L4 (전송계층) : 
  * 전송계층의 정보인 tcp, udp, ip 정보로 로드밸런싱한다. 
  * 데이터 안을 보지 않으므로 패킷 내용 복호화가 필요없어서 속도가 빠르다. 
  * L7 로드밸런싱보다 저렴하다.
  * 예시 : https://github.com/Beakjiyeon/ 접근 시 서버 a, b 로 고르게 로드밸런싱
* L7 (응용계층) : 
  * 응용계층의 정보인 사용자 요청 정보(HTTP header, cookie 등)로 로드밸런싱한다.
  * 섬세한 라우팅이 가능하고 비정상적인 트래픽을 판별할 수 있다.
  * 패킷 내용 복호화가 필요해서 더 많은 비용이 소요되나.
  * 예시 : https://github.com/Beakjiyeon/ 접근 시 뒤에 있는 url이 /repositorie 냐 /profile 이냐에 따라 담당 서버들로 로드 밸런싱
<br/>

### 로드밸런싱 대표 알고리즘
* 라운드 로빈
  * 서버에 들어오는 요청 순서대로 돌아가며 배정하는 알고리즘이다.
  * 여러 대의 서버 성능이 비슷하고 세션이 오래 지속되지 않는 경우 적합하다. 
* 최소 연결 방식
  * 요청이 서버에 들어왔을 때 가장 연결이 적은 서버에 배정하는 알고리즘이다.
  * 서버 트래픽이 일정하지 않고 세션이 길어질 때 적합하다.
* 가중 라운드 로빈
  * 서버마다 가중치를 매겨 가중치에 맞게 요청을 배정
* ip 해싱 
  * 클라이언트의 ip주소를 해싱하여 분배
* 최소 응답시간
  * 서버의 현재 연결 상태와 응답시간을 고려하여 배분
<br/>

### 로드밸런싱 기능
* 헬스 체크
  * 서버들에 대한 주기적인 상태 확인을 통해 서버들의 장애 여부를 판단할 수 있따.
  * 서버에 이상이 생기면 정상적으로 동작하는 서버로 트래픽을 보내주는데 fail-over가 가gkek.
  * tcp, udp 분석이 가능하기 때문에 방화벽의 역할도 할 수 있다.
  * L3 : icmp를 이요해 서버의 ip 주소가 통신 가능한 상태인지 확인한다.
  * L4 : tcp의 3-way handshaking을 통해 각 서버의 포트 상태를 확인한다.
  * L7 : 실제 웹 페이지에 통신을 시도해 이상 유무를 파악한다.  
* Tunneling
  * 데이터를 캡슐화해서 연결된 상호간에만 캡슐화된 패킷을 구별해 캡슐화를 해제할 수 있다. 
* NAT
  * 내부 네트워크에서 사용하던 사설 ip 주소도 로드밸런서 외부의 공인 ip 주소로 변경해주며 반대 과정도 가능하다.
  * 로드밸런서에선 여러 개의 호스트가 하나의 공인 ip 주소(vip)를 통해 접속한다. 
* DSR
  * 서버에서 클라이언트로 되돌아가는 경우, 목적지를 클라이언트로 설정한 다음 네트워크, 로드밸런서를 거치지 않고 바로 클라이언트로 찾아가는 방식이다.
  * 로드밸런서의 부하를 줄일 수 있다.

<br/>
<br/>
<hr/>

### 참고 레퍼런스
* https://www.youtube.com/watch?v=YxwYhenZ3BE
* https://mkki.github.io/interview/2018/12/20/qna-for-job-interview.html
* https://maivve.tistory.com/269
* https://velog.io/@awt0311/%EB%A1%9C%EB%93%9C-%EB%B0%B8%EB%9F%B0%EC%8B%B1
* https://steady-coding.tistory.com/535
